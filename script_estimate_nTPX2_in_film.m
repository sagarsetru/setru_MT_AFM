% 6 July 2020
% script for determining effect film height
% Sagar Setru

addpath(genpath('/Users/sagarsetru/Documents/Princeton/woods hole physio 2019/data analysis'))

%%

% to convert from pixel to nm
pix_to_nm = 2000/256;
pix_to_m = pix_to_nm * 1e-9;
pix_to_um = 2/256;

n_avogadro = 6.02*10^23;

%% 2019 07 13 stack 68-89, 2x2um
l_1 = sum([...
    141.51,...
    69.123,...
    ])*pix_to_m; % m

l_2 = sum([...
    254.23,...
    87.89,...
    50.77,...
    ])*pix_to_m; % m

l_tot = mean([...
    l_1,...
    l_2,...
    ]);

% area of imaged region
a = 2e-6*2e-6; % m^2

% bulk concentration
c = 200*1e-9; % molar concentration = moles of solute/liters of solvent

% measured film heights
h_avg = mean([...
    15.70,...
    12.60,...
    15.54,...
    ]); % nm

[h_eff, V_incl, V_excl] = determineEffectiveFilmHeight(h_avg); % nm, nm^2, nm^2
V_incl = V_incl*1e-18; % m^2

V_meniscus = 50; % ul
V_meniscus = V_meniscus*1e-9; % m^3

[rho_tpx2_density_in_film1,...
    V_exposed_to_bulk_total1,...
    l_mt_total1,...
    n_molecule_total1] = estimate_tpx2_density_on_MTs(...
    c,...
    V_meniscus,...
    l_tot,...
    a,...
    V_incl); % n molecules / m^3, m^3, m, n

rho_tpx2_density_in_film1 = rho_tpx2_density_in_film1 * (1/1e18)
% n molecules/um^3

%% 2019 07 16 stack 225-261, 2x2um
l_1 = sum([...
    285.13,...
    120.83,...
    26.63,...
    61.62,...
    ])*pix_to_m; % m

l_2 = [...
    ]*pix_to_m; % m

l_tot = mean([...
    l_1,...
    l_2,...
    ]);

% area of imaged region
a = 2e-6*2e-6; % m^2

% bulk concentration
c = 200*1e-9; % molar concentration = moles of solute/liters of solvent

% measured film heights
h_avg = mean([...
    15.70,...
    12.60,...
    15.54,...
    ]); % nm

[h1_eff, V_incl, V_excl] = determineEffectiveFilmHeight(h_avg); % nm, nm^2, nm^2
V_incl = V_incl*1e-18; % m^2

V_meniscus = 50; % ul
V_meniscus = V_meniscus*1e-9; % m^3

[rho_tpx2_density_in_film2,...
    V_exposed_to_bulk_total2,...
    l_mt_total2,...
    n_molecule_total2] = estimate_tpx2_density_on_MTs(...
    c,...
    V_meniscus,...
    l_tot,...
    a,...
    V_incl); % n molecules / m^3, m^3, m, n

rho_tpx2_density_in_film2 = rho_tpx2_density_in_film2 * (1/1e18)
% n molecules/um^3

%% 2019 10 25 stack 114-116, 117-118, 119-120 4x4um
l_1 = sum([...
    40,...
    260,...
    25,...
    268,...
    28,...
    359,...
    165,...
    ])*pix_to_m; % m

l_2 = sum([...
    622,...
    220,...
    36,...
    165,...
    419,...
    124,...
    ])*pix_to_m; % m

l_3 = sum([...
    642,...
    187,...
    192,...
    176,...
    289,...
    ])*pix_to_m; % m

l_tot = mean([...
    l_1,...
    l_2,...
    l_3,...
    ]);

% l_avg = [163.725]*pix_to_m;

% area of imaged region
a = 4e-6*4e-6; % m^2

% bulk concentration
c = 600*1e-9; % molar concentration = moles of solute/liters of solvent

% measured film heights
h_avg = mean([...
    18.80,...
    ]); % nm

[h1_eff, V_incl, V_excl] = determineEffectiveFilmHeight(h_avg); % nm, nm^2, nm^2
V_incl = V_incl*1e-18; % m^2

V_meniscus = 50; % ul
V_meniscus = V_meniscus*1e-9; % m^3

[rho_tpx2_density_in_film3,...
    V_exposed_to_bulk_total3,...
    l_mt_total3,...
    n_molecule_total3] = estimate_tpx2_density_on_MTs(...
    c,...
    V_meniscus,...
    l_tot,...
    a,...
    V_incl); % n molecules / m^3, m^3, m, n

rho_tpx2_density_in_film3 = rho_tpx2_density_in_film3 * (1/1e18)
% n molecules/um^3

%% 2019 10 28 stack 1-25, 26-29, 30-32, 33-36  2x2um
l_1 = sum([...
    121,...
    107,...
    29,...
    ])*pix_to_m; % m

l_2 = sum([...
    189,...
    69,...
    56,...
    96,...
    120,...
    28,...
    ])*pix_to_m; % m

l_3 = sum([...
    642,...
    187,...
    192,...
    176,...
    289,...
    ])*pix_to_m; % m

l_4 = sum([...
    267,...
    65,...
    189,...
    212,...
    91,...
    178,...
    32,...
    11,...
    62,...
    ])*pix_to_m;

l_5 = [...
    268,...
    256,...
    105,...
    72,...
    191,...
    82,...
    16,...
    ]*pix_to_m;

l_tot = mean([...
    l_1,...
    l_2,...
    l_3,...
    l_4,...
    l_5,...
    ]);

% l_avg = [163.725]*pix_to_m;

% area of imaged region
a = 2e-6*2e-6; % m^2

% bulk concentration
c = 100*1e-9; % molar concentration = moles of solute/liters of solvent

% measured film heights
h_avg = mean([...
    13.17,...
    13.56,...
    ]); % nm

[h1_eff, V_incl, V_excl] = determineEffectiveFilmHeight(h_avg); % nm, nm^2, nm^2
V_incl = V_incl*1e-18; % m^2

V_meniscus = 50; % ul
V_meniscus = V_meniscus*1e-9; % m^3

[rho_tpx2_density_in_film4,...
    V_exposed_to_bulk_total4,...
    l_mt_total4,...
    n_molecule_total4] = estimate_tpx2_density_on_MTs(...
    c,...
    V_meniscus,...
    l_tot,...
    a,...
    V_incl); % n molecules / m^3, m^3, m, number

rho_tpx2_density_in_film4 = rho_tpx2_density_in_film4 * (1/1e18)
% n molecules/um^3

n_per_m_4 = n_molecule_total4/l_mt_total4;
n_per_um_4 = n_per_m_4/1e6

%% 2019 10 28 expt 1, stack 1-25, 26-29, 30-32, 33-36  2x2um
l_1 = sum([...
    121,...
    107,...
    29,...
    ]*pix_to_m); % m

l_2 = sum([...
    189,...
    69,...
    56,...
    96,...
    120,...
    28,...
    ]*pix_to_m); % m

l_3 = sum([...
    642,...
    187,...
    192,...
    176,...
    289,...
    ]*pix_to_m); % m

l_4 = sum([...
    267,...
    65,...
    189,...
    212,...
    91,...
    178,...
    32,...
    11,...
    62,...
    ]*pix_to_m);

l_5 = sum([...
    268,...
    256,...
    105,...
    72,...
    191,...
    82,...
    16,...
    ]*pix_to_m);

l_tot = mean([...
    l_1,...
    l_2,...
    l_3,...
    l_4,...
    l_5,...
    ]);

% l_tot = [...
%     l_1,...
%     l_2,...
%     l_3,...
%     l_4,...
%     l_5,...
%     ];

% l_avg = [163.725]*pix_to_m;

% area of imaged region
a = 2e-6*2e-6; % m^2

% bulk concentration
c = 100*1e-9; % molar concentration = moles of solute/liters of solvent

% measured film heights
% h_avg = mean([...
%     13.17,...
%     13.56,...
%     ]); % nm

h_avg = [13.4]; % nm

[h1_eff, V_incl, V_excl] = determineEffectiveFilmHeight(h_avg); % nm, nm^2, nm^2
V_incl = (V_incl+V_excl)*1e-18; % m^2
% V_incl = (V_incl)*1e-18; % m^2
% V_incl = (V_incl+V_excl); % nm^2


V_meniscus = 50; % ul
V_meniscus = V_meniscus*1e-9; % m^3

[rho_tpx2_density_in_film4,...
    V_exposed_to_bulk_total4,...
    l_mt_total4,...
    n_molecule_total4] = estimate_tpx2_density_on_MTs(...
    c,...
    V_meniscus,...
    l_tot,...
    a,...
    V_incl); % n molecules / m^3, m^3, m, number

molarity_tpx2_in_film4 = rho_tpx2_density_in_film4/(6.02e23)/1000
rho_tpx2_density_in_film4 = rho_tpx2_density_in_film4 * (1/1e18)

% n molecules/um^3

n_per_m_4 = n_molecule_total4/l_mt_total4;
n_per_um_4 = n_per_m_4/1e6


%% 2019 10 28 expt2, stack 37-59, 60-62, 63-67, 68-72  2x2um
l_1 = [...
    39,...
    126,...
    90,...
    34,...
    25,...
    103,...
    131,...
    42,...
    206,...
    ]*pix_to_m; % m

l_2 = [...
    45,...
    47,...
    200,...
    27,...
    187,...
    268,...
    57,...
    206,...
    53,...
    ]*pix_to_m; % m

l_3 = [...
    56,...
    74,...
    291,...
    36,...
    225,...
    184,...
    118,...
    ]*pix_to_m; % m

l_4 = [...
    129,...
    19,...
    264,...
    231,...
    ]*pix_to_m;

l_5 = [...
    ]*pix_to_m;

l_tot = sum([...
    l_1,...
    l_2,...
    l_3,...
    l_4,...
    l_5,...
    ]);

% l_avg = [163.725]*pix_to_m;

% area of imaged region
a = 2e-6*2e-6*4; % m^2

% bulk concentration
c = 100*1e-9; % molar concentration = moles of solute/liters of solvent

% measured film heights
h_avg = mean([...
    11.59,...
    13.40,...
    10.84,...
    ]); % nm

[h1_eff, V_incl, V_excl] = determineEffectiveFilmHeight(h_avg); % nm, nm^2, nm^2
V_incl = V_incl*1e-18; % m^2

V_meniscus = 50; % ul
V_meniscus = V_meniscus*1e-9; % m^3

[rho_tpx2_density_in_film5,...
    V_exposed_to_bulk_total5,...
    l_mt_total5,...
    n_molecule_total5] = estimate_tpx2_density_on_MTs(...
    c,...
    V_meniscus,...
    l_tot,...
    a,...
    V_incl); % n molecules / m^3, m^3, m, number

rho_tpx2_density_in_film5 = rho_tpx2_density_in_film5 * (1/1e18)
% n molecules/um^3

n_per_m_5 = n_molecule_total5/l_mt_total5;
n_per_um_5 = n_per_m_5/1e6

%%
rho_all = [...
    rho_tpx2_density_in_film1,...
    rho_tpx2_density_in_film2,...
    rho_tpx2_density_in_film3,...
    rho_tpx2_density_in_film4,...
    rho_tpx2_density_in_film5
    ]

55.5*6.02*10^23 * (1/1e15)

%% estimate mean free path (MFP)

% following Satish G. Kandlikar, Michael R. King, in 
% Heat Transfer and Fluid Flow in Minichannels and Microchannels
% (Second Edition), 2014

kT = 4.11*10^21; %J
RT = kT/n_avogadro;
mu = [10^(-1) 10^0 10^1 10^2 10^3]; % Pa*s
mu = [1 10 100]; % Pa*s
rho = 1.6; % kg/m^3

mfp = ( mu * sqrt(pi) )/( rho * sqrt(2*RT) )